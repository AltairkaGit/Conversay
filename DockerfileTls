#
# Build stage
#
FROM maven:3-amazoncorretto-17 AS build
WORKDIR /app/

COPY . ./
#Install maven deps
RUN mvn -f ./pom.xml clean package
#
# Package stage
#
FROM amazoncorretto:17-alpine
WORKDIR /app-serv/
COPY --from=build /app/target/leopold-0.0.1-SNAPSHOT.jar .
COPY --from=build /app/src/main/resources .
RUN rm application.properties
RUN mv application-tls.properties application.properties
COPY --from=build /app/ .
RUN chmod +r Server-keystore.p12
RUN chmod +x leopold-0.0.1-SNAPSHOT.jar

# Expose the port your application will run on
EXPOSE 443

CMD ["java", "-jar", "leopold-0.0.1-SNAPSHOT.jar"]
